<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Groups Page</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://code.jquery.com/jquery-3.6.3.min.js"
    integrity="sha256-pvPw+upLPUjgMXY0G+8O0xUf+/Im1MZjXxxgOcBQBXU=" crossorigin="anonymous"></script>
    <style>
        body {
            font-family: 'Roboto', sans-serif;
            color: #000;
            background-color: #fff;
        }
        table {
            width: 100%;
            border-collapse: collapse;
        }
        th, td {
            border: 1px solid #000;
            padding: 8px;
            text-align: left;
        }
        a {
            color: #000;
            text-decoration: underline;
        }
        #input-container {
            display: none;
        }
        footer {
            position: fixed;
            left: 0;
            bottom: 0;
            width: 100%;
            text-align: center;
            background-color: #f9f9f9; 
            padding: 10px 0; 
        }
        .center-form {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .center-form label, .center-form input {
            display: block; /* Display label and input as block elements */
            text-align: left; /* Align text to the left */
            width: 100%; /* Take the full width of the container */
        }

    </style>
</head>
<body>
    <table id="groups-table">
        <tr>
            <th>#</th>
            <th>Group</th>
            <th>Description</th>
        </tr>
    </table>
    <div id="input-container">
        <input type="text" id="email-input" placeholder="Enter your email">
        <button id="add-button">Add</button>
    </div>
    <footer>
        <div id="admin-link" style="text-align: center;">
            <a href="#">admin</a>
        </div>
    </footer>
    <div id="login-form" class="center-form" style="display: none;">
        <label for="username">Username:</label>
        <input type="text" id="username" name="username">
        <label for="password">Password:</label>
        <input type="password" id="password" name="password">
        <button id="login-button" type="submit">Login</button>
    </div>
   <div id="group-form" class="center-form" style="display: none;">
        <form>
            <label for="group-name">Group Name:</label>
            <input type="text" id="group-name" name="group-name">
            <label for="group-description">Group Description:</label>
            <input type="text" id="group-description" name="group-description">
            <button id="add-group-button">Add Group</button>
        </form>
    </div>
    <script>
        var selectedGroupId = null;

        // Fetch groups from the backend API
        $.getJSON("https://zqikycpua2.execute-api.us-east-1.amazonaws.com/Prod/groups", function(data) {
            $.each(data, function(key, group) {
                $("#groups-table").append(`<tr>
                                            <td>${key + 1}</td>
                                            <td><a href="#" class="group-link" data-id="${group.id}">${group.name}</a></td>
                                            <td>${group.description}</td>
                                          </tr>`);
            });
        });

        // Event listener for clicking on a group link
        $(document).on("click", ".group-link", function(e) {
            e.preventDefault();
            selectedGroupId = $(this).data("id");
            $("#input-container").show();
        });

        // Event listener for clicking the Add button
        $("#add-button").click(function() {
            var email = $("#email-input").val();
            // Send API request with group ID and email
            $.ajax({
              url: `https://zqikycpua2.execute-api.us-east-1.amazonaws.com/Prod/groups/${selectedGroupId}`,
              type: "POST",
              contentType: "application/json",
              data: JSON.stringify({ email: email }),
              success: function() {
                alert("Email added successfully!");
                $("#input-container").hide();
                $("#email-input").val("");
              }
            });
        });
        $("#admin-link").click(function(e) {
            e.preventDefault();
            $("#groups-table").hide();
            $("#group-form").hide();
            $("#login-form").show();
        });
        $("#login-button").click(function(e) {
            e.preventDefault();
            var username = $("#username-input").val();
            var password = $("#password-input").val();
        
            $("#login-form").hide();
            $("#group-form").show();
        
            // Save the credentials to be used later
            localStorage.setItem("username", username);
            localStorage.setItem("password", password);
        });

$("#add-group-button").click(function(e) {
    e.preventDefault();
    var groupName = $("#group-name").val();
    var groupDescription = $("#group-description").val();

    // Retrieve saved credentials
    var username = localStorage.getItem("username");
    var password = localStorage.getItem("password");

    // Create a basic authentication header
    var headers = {
        "Authorization": "Basic " + btoa(username + ":" + password),
        "Content-Type": "application/json"
    };

    // Create the data object
    var data = {
        name: groupName,
        description: groupDescription
    };

    // Make the POST request
    $.ajax({
        url: "https://zqikycpua2.execute-api.us-east-1.amazonaws.com/Prod/groups",
        type: "POST",
        headers: headers,
        data: JSON.stringify(data),
        success: function() {
            alert("Group added successfully!");
            $("#group-form").hide();
        },
        error: function() {
            alert("Error adding group!");
        }
    });
});

    </script>
</body>
</html>
